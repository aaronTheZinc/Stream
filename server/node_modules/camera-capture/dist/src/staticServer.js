"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const http_1 = require("http");
const path_1 = require("path");
function staticServer(basePath, port = 9999, onFound = () => { }, onNotFound = () => { }) {
    return new Promise(async (resolve) => {
        const server = http_1.createServer((req, res) => {
            var url = resolveUrl(req.url);
            onFound && onFound(url);
            var stream = fs_1.createReadStream(path_1.join(basePath, url || ''));
            stream.on('error', function () {
                onNotFound && onNotFound(url);
                res.writeHead(404);
                res.end();
            });
            stream.pipe(res);
        }).listen(port);
        server.on('listening', () => {
            resolve(server);
        });
    });
    function resolveUrl(url = '') {
        var i = url.indexOf('?');
        if (i != -1) {
            url = url.substr(0, i);
        }
        i = url.indexOf('#');
        if (i != -1) {
            url = url.substr(0, i);
        }
        return url;
    }
}
exports.staticServer = staticServer;
//# sourceMappingURL=staticServer.js.map